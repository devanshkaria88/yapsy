{"openapi":"3.0.0","paths":{"/api/v1/admin/auth/firebase":{"post":{"description":"Exchange a Firebase ID token for admin JWT tokens. The email must exist in admin_users table.","operationId":"admin_AdminAuthController_firebaseAuth","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/FirebaseAuthDto"}}}},"responses":{"201":{"description":"Admin auth successful","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AdminAuthResponseDto"}}}},"401":{"description":"Invalid Firebase token"},"403":{"description":"No admin account for this email"}},"security":[{"admin-jwt":[]}],"summary":"Admin authenticate with Firebase","tags":["Admin Auth"]}},"/api/v1/admin/auth/refresh":{"post":{"operationId":"admin_AdminAuthController_refresh","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RefreshTokenDto"}}}},"responses":{"201":{"description":"Tokens refreshed","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AdminAuthResponseDto"}}}},"401":{"description":"Invalid refresh token"}},"security":[{"admin-jwt":[]}],"summary":"Refresh admin access token","tags":["Admin Auth"]}},"/api/v1/admin/auth/logout":{"post":{"operationId":"admin_AdminAuthController_logout","parameters":[],"responses":{"201":{"description":"Logged out"}},"security":[{"admin-jwt":[]}],"summary":"Admin logout and invalidate refresh token","tags":["Admin Auth"]}},"/api/v1/admin/users":{"get":{"operationId":"admin_AdminUsersController_findAll","parameters":[{"name":"page","required":false,"in":"query","schema":{"minimum":1,"default":1,"type":"number"}},{"name":"limit","required":false,"in":"query","schema":{"minimum":1,"maximum":100,"default":20,"type":"number"}},{"name":"search","required":false,"in":"query","description":"Search by email or name","schema":{"type":"string"}},{"name":"subscription_status","required":false,"in":"query","description":"Filter by subscription status","schema":{"type":"string","enum":["free","pro","cancelled","paused","past_due"]}},{"name":"sort_by","required":false,"in":"query","description":"Sort field","schema":{"default":"created_at","type":"string"}},{"name":"sort_order","required":false,"in":"query","description":"Sort order","schema":{"default":"DESC","type":"string","enum":["ASC","DESC"]}}],"responses":{"200":{"description":"Paginated list of users"},"401":{"description":"Unauthorized"}},"security":[{"admin-jwt":[]}],"summary":"List all users with pagination and filters","tags":["Admin Users"]}},"/api/v1/admin/users/{id}":{"get":{"operationId":"admin_AdminUsersController_findOne","parameters":[{"name":"id","required":true,"in":"path","description":"User UUID","schema":{"type":"string"}}],"responses":{"200":{"description":"User details returned successfully"},"401":{"description":"Unauthorized"},"404":{"description":"User not found"}},"security":[{"admin-jwt":[]}],"summary":"Get user details by ID","tags":["Admin Users"]}},"/api/v1/admin/users/{id}/subscription":{"patch":{"operationId":"admin_AdminUsersController_updateSubscription","parameters":[{"name":"id","required":true,"in":"path","description":"User UUID","schema":{"type":"string"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UpdateSubscriptionDto"}}}},"responses":{"200":{"description":"Subscription updated successfully"},"401":{"description":"Unauthorized"},"403":{"description":"Forbidden - Super Admin required"},"404":{"description":"User not found"}},"security":[{"admin-jwt":[]}],"summary":"Update user subscription status (Super Admin only)","tags":["Admin Users"]}},"/api/v1/admin/subscriptions/plans":{"get":{"operationId":"admin_AdminSubscriptionsController_getPlansAdmin","parameters":[],"responses":{"200":{"description":"List of all plans"},"401":{"description":"Unauthorized"}},"security":[{"admin-jwt":[]}],"summary":"Get all plans including inactive","tags":["Admin Subscriptions"]},"post":{"operationId":"admin_AdminSubscriptionsController_createPlan","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreatePlanDto"}}}},"responses":{"201":{"description":"Plan created successfully"},"401":{"description":"Unauthorized"},"403":{"description":"Forbidden - Super Admin required"}},"security":[{"admin-jwt":[]}],"summary":"Create a new plan (Super Admin only)","tags":["Admin Subscriptions"]}},"/api/v1/admin/subscriptions/plans/{id}":{"patch":{"operationId":"admin_AdminSubscriptionsController_updatePlan","parameters":[{"name":"id","required":true,"in":"path","description":"Plan UUID","schema":{"type":"string"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UpdatePlanDto"}}}},"responses":{"200":{"description":"Plan updated successfully"},"401":{"description":"Unauthorized"},"403":{"description":"Forbidden - Super Admin required"},"404":{"description":"Plan not found"}},"security":[{"admin-jwt":[]}],"summary":"Update a plan (Super Admin only)","tags":["Admin Subscriptions"]},"delete":{"operationId":"admin_AdminSubscriptionsController_deactivatePlan","parameters":[{"name":"id","required":true,"in":"path","description":"Plan UUID","schema":{"type":"string"}}],"responses":{"200":{"description":"Plan deactivated successfully"},"401":{"description":"Unauthorized"},"403":{"description":"Forbidden - Super Admin required"},"404":{"description":"Plan not found"}},"security":[{"admin-jwt":[]}],"summary":"Deactivate a plan (Super Admin only)","tags":["Admin Subscriptions"]}},"/api/v1/admin/subscriptions/stats":{"get":{"operationId":"admin_AdminSubscriptionsController_getStats","parameters":[],"responses":{"200":{"description":"Subscription stats (total pro, free, MRR)"},"401":{"description":"Unauthorized"}},"security":[{"admin-jwt":[]}],"summary":"Get subscription statistics","tags":["Admin Subscriptions"]}},"/api/v1/admin/promo-codes":{"get":{"operationId":"admin_AdminPromoCodesController_findAll","parameters":[{"name":"page","required":false,"in":"query","schema":{"minimum":1,"default":1,"type":"number"}},{"name":"limit","required":false,"in":"query","schema":{"minimum":1,"maximum":100,"default":20,"type":"number"}}],"responses":{"200":{"description":"Paginated list of promo codes"},"401":{"description":"Unauthorized"}},"security":[{"admin-jwt":[]}],"summary":"List all promo codes with pagination","tags":["Admin Promo Codes"]},"post":{"operationId":"admin_AdminPromoCodesController_create","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreatePromoDto"}}}},"responses":{"201":{"description":"Promo code created successfully"},"400":{"description":"Validation error or code already exists"},"401":{"description":"Unauthorized"}},"security":[{"admin-jwt":[]}],"summary":"Create a new promo code","tags":["Admin Promo Codes"]}},"/api/v1/admin/promo-codes/{id}/redemptions":{"get":{"operationId":"admin_AdminPromoCodesController_getRedemptions","parameters":[{"name":"id","required":true,"in":"path","description":"Promo code UUID","schema":{"type":"string"}}],"responses":{"200":{"description":"List of redemptions with user info"},"401":{"description":"Unauthorized"},"404":{"description":"Promo code not found"}},"security":[{"admin-jwt":[]}],"summary":"Get redemptions for a promo code","tags":["Admin Promo Codes"]}},"/api/v1/admin/promo-codes/{id}":{"patch":{"operationId":"admin_AdminPromoCodesController_update","parameters":[{"name":"id","required":true,"in":"path","description":"Promo code UUID","schema":{"type":"string"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UpdatePromoDto"}}}},"responses":{"200":{"description":"Promo code updated successfully"},"401":{"description":"Unauthorized"},"404":{"description":"Promo code not found"}},"security":[{"admin-jwt":[]}],"summary":"Update a promo code","tags":["Admin Promo Codes"]},"delete":{"operationId":"admin_AdminPromoCodesController_deactivate","parameters":[{"name":"id","required":true,"in":"path","description":"Promo code UUID","schema":{"type":"string"}}],"responses":{"200":{"description":"Promo code deactivated successfully"},"401":{"description":"Unauthorized"},"404":{"description":"Promo code not found"}},"security":[{"admin-jwt":[]}],"summary":"Deactivate a promo code","tags":["Admin Promo Codes"]}},"/api/v1/admin/dashboard/overview":{"get":{"operationId":"admin_DashboardController_getOverview","parameters":[],"responses":{"200":{"description":"Overview metrics returned"},"401":{"description":"Unauthorized"}},"security":[{"admin-jwt":[]}],"summary":"Get dashboard overview metrics","tags":["Admin Dashboard","Admin Dashboard"]}},"/api/v1/admin/dashboard/growth":{"get":{"operationId":"admin_DashboardController_getGrowth","parameters":[{"name":"days","required":false,"in":"query","description":"Number of days to look back (default: 30)","schema":{"type":"number"}}],"responses":{"200":{"description":"Growth data by date"},"401":{"description":"Unauthorized"}},"security":[{"admin-jwt":[]}],"summary":"Get user registration growth over time","tags":["Admin Dashboard","Admin Dashboard"]}},"/api/v1/admin/dashboard/check-ins":{"get":{"operationId":"admin_DashboardController_getCheckIns","parameters":[{"name":"days","required":false,"in":"query","description":"Number of days to look back (default: 30)","schema":{"type":"number"}}],"responses":{"200":{"description":"Check-ins data by date"},"401":{"description":"Unauthorized"}},"security":[{"admin-jwt":[]}],"summary":"Get check-ins per day","tags":["Admin Dashboard","Admin Dashboard"]}},"/api/v1/admin/dashboard/revenue":{"get":{"operationId":"admin_DashboardController_getRevenue","parameters":[],"responses":{"200":{"description":"Revenue and plan breakdown"},"401":{"description":"Unauthorized"}},"security":[{"admin-jwt":[]}],"summary":"Get revenue and subscriber metrics","tags":["Admin Dashboard","Admin Dashboard"]}},"/api/v1/admin/analytics/mood-distribution":{"get":{"operationId":"admin_AnalyticsController_getMoodDistribution","parameters":[],"responses":{"200":{"description":"Mood distribution returned"},"401":{"description":"Unauthorized"}},"security":[{"admin-jwt":[]}],"summary":"Get mood score distribution (low/medium/high)","tags":["Admin Analytics","Admin Analytics"]}},"/api/v1/admin/analytics/retention":{"get":{"operationId":"admin_AnalyticsController_getRetention","parameters":[{"name":"months","required":false,"in":"query","description":"Number of cohort months to analyze (default: 6)","schema":{"type":"number"}}],"responses":{"200":{"description":"Retention data by cohort"},"401":{"description":"Unauthorized"}},"security":[{"admin-jwt":[]}],"summary":"Get cohort retention metrics","tags":["Admin Analytics","Admin Analytics"]}},"/api/v1/admin/analytics/feature-usage":{"get":{"operationId":"admin_AnalyticsController_getFeatureUsage","parameters":[],"responses":{"200":{"description":"Feature usage stats returned"},"401":{"description":"Unauthorized"}},"security":[{"admin-jwt":[]}],"summary":"Get feature usage statistics","tags":["Admin Analytics","Admin Analytics"]}},"/api/v1/admin/analytics/conversion-funnel":{"get":{"operationId":"admin_AnalyticsController_getConversionFunnel","parameters":[],"responses":{"200":{"description":"Conversion funnel returned"},"401":{"description":"Unauthorized"}},"security":[{"admin-jwt":[]}],"summary":"Get conversion funnel metrics","tags":["Admin Analytics","Admin Analytics"]}},"/api/v1/admin/analytics/themes":{"get":{"operationId":"admin_AnalyticsController_getThemes","parameters":[],"responses":{"200":{"description":"Top 20 themes with counts"},"401":{"description":"Unauthorized"}},"security":[{"admin-jwt":[]}],"summary":"Get top themes from journals","tags":["Admin Analytics","Admin Analytics"]}},"/api/v1/admin/system/health":{"get":{"operationId":"admin_SystemController_getHealth","parameters":[],"responses":{"200":{"description":"Health status returned"},"401":{"description":"Unauthorized"}},"security":[{"admin-jwt":[]}],"summary":"Get system health status","tags":["Admin System","Admin System"]}},"/api/v1/admin/system/costs":{"get":{"operationId":"admin_SystemController_getCosts","parameters":[],"responses":{"200":{"description":"Cost breakdown returned"},"401":{"description":"Unauthorized"}},"security":[{"admin-jwt":[]}],"summary":"Get API cost tracking (placeholder)","tags":["Admin System","Admin System"]}},"/api/v1/admin/system/errors":{"get":{"operationId":"admin_SystemController_getErrors","parameters":[{"name":"limit","required":false,"in":"query","description":"Max number of events to return (default: 50)","schema":{"type":"number"}}],"responses":{"200":{"description":"List of error webhook events"},"401":{"description":"Unauthorized"}},"security":[{"admin-jwt":[]}],"summary":"Get recent failed webhook events","tags":["Admin System","Admin System"]}},"/api/v1/admin/system/webhooks":{"get":{"operationId":"admin_SystemController_getWebhooks","parameters":[{"name":"limit","required":false,"in":"query","description":"Max number of events to return (default: 50)","schema":{"type":"number"}}],"responses":{"200":{"description":"List of webhook events"},"401":{"description":"Unauthorized"}},"security":[{"admin-jwt":[]}],"summary":"Get recent webhook events","tags":["Admin System","Admin System"]}},"/api/v1/admin/system/webhooks/{id}/retry":{"post":{"operationId":"admin_SystemController_retryWebhook","parameters":[{"name":"id","required":true,"in":"path","description":"Webhook event UUID","schema":{"type":"string"}}],"responses":{"200":{"description":"Webhook reprocessed successfully"},"401":{"description":"Unauthorized"},"403":{"description":"Forbidden - Super Admin required"},"404":{"description":"Webhook event not found"}},"security":[{"admin-jwt":[]}],"summary":"Retry a failed webhook event (Super Admin only)","tags":["Admin System","Admin System"]}}},"info":{"title":"Yapsy Admin API","description":"API for the Yapsy Admin Dashboard","version":"1.0","contact":{}},"tags":[],"servers":[],"components":{"securitySchemes":{"admin-jwt":{"scheme":"bearer","bearerFormat":"JWT","type":"http"}},"schemas":{"FirebaseAuthDto":{"type":"object","properties":{"id_token":{"type":"string","description":"Firebase ID token from the client SDK","example":"eyJhbGciOiJSUzI1NiIsImtpZCI6..."}},"required":["id_token"]},"AuthUserDto":{"type":"object","properties":{"id":{"type":"string"},"email":{"type":"string"},"name":{"type":"object","nullable":true},"avatar_url":{"type":"object","nullable":true},"subscription_status":{"type":"string","enum":["free","pro","cancelled","paused","past_due"]},"is_onboarded":{"type":"boolean","description":"Whether the user has completed onboarding"},"gender":{"type":"string","nullable":true,"enum":["male","female","non_binary","prefer_not_to_say"]},"date_of_birth":{"type":"object","nullable":true}},"required":["id","email","name","avatar_url","subscription_status","is_onboarded","gender","date_of_birth"]},"AuthResponseDto":{"type":"object","properties":{"access_token":{"type":"string","example":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."},"refresh_token":{"type":"string","example":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."},"user":{"$ref":"#/components/schemas/AuthUserDto"}},"required":["access_token","refresh_token","user"]},"OnboardingDto":{"type":"object","properties":{"name":{"type":"string","description":"User display name","example":"Devansh"},"date_of_birth":{"type":"string","description":"Date of birth (YYYY-MM-DD)","example":"1998-05-15"},"gender":{"type":"string","description":"Gender","enum":["male","female","non_binary","prefer_not_to_say"],"example":"male"},"timezone":{"type":"string","description":"User timezone","example":"Asia/Kolkata"}},"required":["name","date_of_birth","gender"]},"RefreshTokenDto":{"type":"object","properties":{"refresh_token":{"type":"string","example":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."}},"required":["refresh_token"]},"AdminAuthResponseDto":{"type":"object","properties":{"access_token":{"type":"string"},"refresh_token":{"type":"string"},"admin":{"type":"object"}},"required":["access_token","refresh_token","admin"]},"UpdateUserDto":{"type":"object","properties":{"name":{"type":"string","description":"User display name"},"avatar_url":{"type":"string","description":"Avatar URL"},"timezone":{"type":"string","description":"User timezone (e.g. Asia/Kolkata)"}}},"UpdateFcmTokenDto":{"type":"object","properties":{"fcm_token":{"type":"string","description":"Firebase Cloud Messaging token for push notifications"}},"required":["fcm_token"]},"UpdateSubscriptionDto":{"type":"object","properties":{"subscription_status":{"type":"string","enum":["free","pro","cancelled","paused","past_due"],"description":"Subscription status"}},"required":["subscription_status"]},"CreateTaskDto":{"type":"object","properties":{"title":{"type":"string","description":"Task title","example":"Buy groceries"},"description":{"type":"string","description":"Task description"},"scheduled_date":{"type":"string","description":"Scheduled date","example":"2026-02-20"},"priority":{"type":"string","enum":["low","medium","high"]},"source":{"type":"string","description":"Task source","default":"manual"}},"required":["title","scheduled_date"]},"UpdateTaskDto":{"type":"object","properties":{"title":{"type":"string","description":"Task title"},"description":{"type":"string","description":"Task description"},"scheduled_date":{"type":"string","description":"Scheduled date","example":"2026-02-20"},"priority":{"type":"string","enum":["low","medium","high"]},"status":{"type":"string","enum":["pending","completed","rolled_over","cancelled"]}}},"RolloverTaskDto":{"type":"object","properties":{"new_date":{"type":"string","description":"New date for the rolled-over task","example":"2026-02-21"}},"required":["new_date"]},"CreateNoteDto":{"type":"object","properties":{"content":{"type":"string","description":"Note content","example":"Call dentist tomorrow"},"follow_up_date":{"type":"string","description":"Follow-up date","example":"2026-02-20"},"source":{"type":"string","description":"Note source","enum":["voice","manual"],"default":"manual"}},"required":["content"]},"UpdateNoteDto":{"type":"object","properties":{"content":{"type":"string","description":"Note content"},"follow_up_date":{"type":"string","description":"Follow-up date","example":"2026-02-20"},"is_resolved":{"type":"boolean","description":"Whether the note is resolved"}}},"TranscriptMessageDto":{"type":"object","properties":{"role":{"type":"string","description":"Role (user/assistant)","example":"user"},"text":{"type":"string","description":"Message text","example":"Hello"},"timestamp":{"type":"number","description":"Timestamp in seconds","example":0}},"required":["role","text","timestamp"]},"SaveConversationDto":{"type":"object","properties":{"conversation_id":{"type":"string","description":"ElevenLabs conversation ID","example":"conv_abc123"},"transcript":{"description":"Transcript array","example":[{"role":"user","text":"Hello","timestamp":0},{"role":"assistant","text":"Hi there!","timestamp":1}],"type":"array","items":{"$ref":"#/components/schemas/TranscriptMessageDto"}},"duration_seconds":{"type":"number","description":"Duration in seconds","example":120},"date":{"type":"string","description":"Date of conversation (defaults to today)","example":"2026-02-15"}},"required":["conversation_id","transcript","duration_seconds"]},"CreateSubscriptionDto":{"type":"object","properties":{"plan_id":{"type":"string","description":"Subscription plan UUID"},"promo_code":{"type":"string","description":"Promo code for discount"}},"required":["plan_id"]},"VerifyPaymentDto":{"type":"object","properties":{"razorpay_payment_id":{"type":"string","description":"Razorpay payment ID"},"razorpay_subscription_id":{"type":"string","description":"Razorpay subscription ID"},"razorpay_signature":{"type":"string","description":"Razorpay signature for verification"}},"required":["razorpay_payment_id","razorpay_subscription_id","razorpay_signature"]},"CreatePlanDto":{"type":"object","properties":{"name":{"type":"string","description":"Plan name","example":"Pro Monthly"},"price_amount":{"type":"number","description":"Price in paise","example":99900},"currency":{"type":"string","description":"Currency code","default":"INR"},"interval":{"type":"string","description":"Billing interval","enum":["monthly","yearly"]},"features":{"type":"object","description":"Plan features as key-value pairs"},"is_active":{"type":"boolean","description":"Whether plan is active","default":true}},"required":["name","price_amount","interval"]},"UpdatePlanDto":{"type":"object","properties":{"name":{"type":"string","description":"Plan name","example":"Pro Monthly"},"price_amount":{"type":"number","description":"Price in paise","example":99900},"currency":{"type":"string","description":"Currency code","default":"INR"},"interval":{"type":"string","description":"Billing interval","enum":["monthly","yearly"]},"features":{"type":"object","description":"Plan features as key-value pairs"},"is_active":{"type":"boolean","description":"Whether plan is active","default":true}}},"RedeemPromoDto":{"type":"object","properties":{"code":{"type":"string","description":"Promo code to redeem","example":"SAVE20"}},"required":["code"]},"CreatePromoDto":{"type":"object","properties":{"code":{"type":"string","description":"Promo code (stored uppercase)","example":"SAVE20"},"type":{"type":"string","enum":["percentage","flat","set_price"],"description":"Discount type"},"value":{"type":"number","description":"Value: percentage (1-100), flat amount in paise, or set price in paise","example":20},"duration_months":{"type":"number","description":"Subscription duration in months when redeemed","example":12},"max_uses":{"type":"number","description":"Maximum number of redemptions allowed","example":100},"valid_from":{"type":"string","description":"Valid from date (ISO 8601)","example":"2026-01-01T00:00:00.000Z"},"valid_until":{"type":"string","description":"Valid until date (ISO 8601)","example":"2026-12-31T23:59:59.000Z"},"is_active":{"type":"boolean","description":"Whether the promo is active","default":true}},"required":["code","type","value","valid_from"]},"UpdatePromoDto":{"type":"object","properties":{"code":{"type":"string","description":"Promo code (stored uppercase)","example":"SAVE20"},"type":{"type":"string","enum":["percentage","flat","set_price"],"description":"Discount type"},"value":{"type":"number","description":"Value: percentage (1-100), flat amount in paise, or set price in paise","example":20},"duration_months":{"type":"number","description":"Subscription duration in months when redeemed","example":12},"max_uses":{"type":"number","description":"Maximum number of redemptions allowed","example":100},"valid_from":{"type":"string","description":"Valid from date (ISO 8601)","example":"2026-01-01T00:00:00.000Z"},"valid_until":{"type":"string","description":"Valid until date (ISO 8601)","example":"2026-12-31T23:59:59.000Z"},"is_active":{"type":"boolean","description":"Whether the promo is active","default":true}}}}}}